## Zookeeper

[TOC]

### **1、谈下你对 Zookeeper 的认识？**

> 首先，Zookeeper 的诞生初衷是想要解决分布系统中的分布式单点问题（* 附加 *），所以Zookeeper支持了集群, 并且能保证在集群中选举出一个Leader 
>
> 其次，Zookeeper 既然替代了单点问题中主节点或代理管理分布式系统。所以Zookeeper 还需要提供了集中式管理、分布式协调，分布式协调等功能都得保证数据的一致性， 所以Zookeeper还实现了基于Paxos 算法的ZAB  (Zookeeper Atomic Broadcast) 。
>
> 另外，Zookeeper 还提供了一些其他功能，比如配置管理、命名服务等...
>



### **2、Zookeeper 都有哪些功能？** 

> 1）注册中心（DNS : Domain Name System， 域名系统）
>
> > 通过域名或者应用名称带实际地址注册进来，这样消费者就能通过Zookeeper对域名或者是应用名称进行解析完成DNS服务，获取实际地址完成请求。   <key,value> = <域名 or 应用名称 ， 地址>
>
> 2）Master 选举（注意：这里是Master选举不是Leader选举）
>
> 3）分布式同步锁（* 这个我不会）
>
> 4）配置管理
>
> > 简单的说就是子系统的配置文件全部从Zookeeper读取，并且监控配置文件节点。这样就能做到我如果需要修改配置文件，我直接修改Zookeeper中的<key,value>数据，节点将自动同步。
>
> 5）集群管理
>
> > 1、可以帮你选出Master (也就是上面第2点说到的)
> >
> > 2、每个子节点（集群的子节点，不是zk的）可以创建一个临时节点（zk的）， 一旦消亡，立刻被感知到。
>
> 6）消息队列
>
> > 1、当一个队列的成员都聚齐时，这个队列才可用，否则一直等待所有成员到达，这种是同步队列。
> >
> > 2、队列按照 FIFO 方式进行入队和出队操作
>
> 7）命名服务
>
> > 利用Zookeeper 的顺序节点，来为类似于订单之类的进行命名。



### **3、谈下你对 ZAB 协议的了解？**



### **4、Zookeeper 怎么保证主从节点的状态同步？**



### **5、Zookeeper 有几种部署模式？**

> 1）单机部署
>
> 2）集群部署
>
> 3）伪集群部署（同一台机子上运行多个，通过不同的配置文件来区分）



### **6、说一下 Zookeeper 的通知机制？**

> zk 有一个watcher事件，能监听到某个节点。节点一旦发生变化，即刻通知客户端。watcher事件监听是一次性的，也就是说建立一个watcher只能检测到一次变化，但是目前的ZkClient 和 Curator 都已经在功能内部屏蔽此问题。可以做到一直监听。



### **7、集群中为什么要有主节点（此问题可以是很多集群的问题）？**

> 1）主节点用于维护集群信息
>
> 2）明确职责，确保数据一致性（按顺序执行，这里就要求只有一个地方能写）



### **8、集群中有 3 台服务器，其中一个节点宕机，这个时候 Zookeeper 还可以使用吗？**

> 可以用，Zookeeper  遵循的是投票数过总机子的一半即可正常服务。
>
> 但是得分两种情况，
>
> 一、挂的不是Leader, 那么将毫无影响系统继续正常服务
>
> 二、挂的是Leader, 那么将进入选举状态（短暂的不对外提供服务），挂掉一台还有两台，也就是说有一台机子可以获取两票，完成选举，重新进入服务状态。
>
> 题外话（投票规则）：zookeeper 原则是先投自己，然后将自己的投票结果同步给别人，别人在它的投票箱子中进行对比，然后改投最强的，再将结果同步回去，查看投票机子是否过半（大家都同票的情况下，判断zxid,  再不行就在判断id [这个是预先配置]）。



### **9、说一下两阶段提交和三阶段提交的过程？分别有什么问题？**



### **10、说下四种类型的数据节点 Znode？**

> 1)  永久节点：只要不手动删除，将永远存在
>
> 2）永久顺序节点
>
> 3）临时节点：与客户端绑定，如果客户端消亡，该节点也将消失
>
> 4）临时顺序节点



### **11、Zookeeper 和 Dubbo 的关系？**







## 题外话

### **1、key \ value 框架的共性是什么 **



### **2、集群的共性是什么 **



### **3、分布式协调框架有哪些，共性是什么，单独又有何特点**







## 附加

###  **1、分布式单点问题**

> 所谓的单点问题就是在分布式系统中一般采用主从或者是代理的方式，主节点（代理）分配任务（请求），子节点进行业务处理。但是这里容易出现主节点（代理）一点挂掉，整个挂掉（在多个子节点也不可用）。