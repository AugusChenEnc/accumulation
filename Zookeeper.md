## Zookeeper

[TOC]

### **1、谈下你对 Zookeeper 的认识？**

> Zookeeper 是一个分布式应用程序协调服务
>
> 首先，它的诞生初衷是想要解决分布系统中的分布式单点故障问题（*附加*），做一个无单点问题的分布式协调框架
>
> 第一：支持集群，这样就能保证相对的高可用
>
> 第二：有Leader支持选举，这样是保证消息一致性的关键，同时能管理子节点
>
> 第三：ZAB  (Zookeeper Atomic Broadcast)，这款算法是基于Paxos 算法实现的，提供了两个功能，一个是奔溃恢复、另外一个是原子广播



### **2、Zookeeper 都有哪些功能？** 

> 1）注册中心（DNS : Domain Name System， 域名系统）
>
> > 通过域名或者应用名称带实际地址注册进来，这样消费者就能通过Zookeeper对域名或者是应用名称进行解析完成DNS服务，获取实际地址完成请求。   <key,value> = <域名 or 应用名称 ， 地址>
>
> 2）Master 选举（注意：这里是Master选举不是Leader选举）
>
> 3）分布式同步锁（* 这个我不会）
>
> 4）配置管理
>
> > 简单的说就是子系统的配置文件全部从Zookeeper读取，并且监控配置文件节点。这样就能做到我如果需要修改配置文件，我直接修改Zookeeper中的<key,value>数据，节点将自动同步。
>
> 5）集群管理
>
> > 1、可以帮你选出Master (也就是上面第2点说到的)
> >
> > 2、每个子节点（集群的子节点，不是zk的）可以创建一个临时节点（zk的）， 一旦消亡，立刻被感知到。
>
> 6）消息队列
>
> > 1、当一个队列的成员都聚齐时，这个队列才可用，否则一直等待所有成员到达，这种是同步队列。
> >
> > 2、队列按照 FIFO 方式进行入队和出队操作
>
> 7）命名服务
>
> > 利用Zookeeper 的顺序节点，来为类似于订单之类的进行命名。



### **3、谈下你对 ZAB 协议的了解？**



### **4、Zookeeper 怎么保证主从节点的状态同步？**



### **5、Zookeeper 有几种部署模式？**

> 1）单机部署
>
> 2）集群部署
>
> 3）伪集群部署（同一台机子上运行多个，通过不同的配置文件来区分）



### **6、说一下 Zookeeper 的通知机制？**

> zk 有一个watcher事件，能监听到某个节点。节点一旦发生变化，即刻通知客户端。watcher事件监听是一次性的，也就是说建立一个watcher只能检测到一次变化，但是目前的ZkClient 和 Curator 都已经在功能内部屏蔽此问题。可以做到一直监听。



### **7、集群中为什么要有主节点（此问题可以是很多集群的问题）？**

> 1）主节点用于维护集群信息
>
> 2）明确职责，确保数据一致性（按顺序执行，这里就要求只有一个地方能写）



### **8、集群中有 3 台服务器，其中一个节点宕机，这个时候 Zookeeper 还可以使用吗？**

> 可以用，Zookeeper  遵循的是投票数过总机子的一半即可正常服务。
>
> 但是得分两种情况，
>
> 一、挂的不是Leader, 那么将毫无影响系统继续正常服务
>
> 二、挂的是Leader, 那么将进入选举状态（短暂的不对外提供服务），挂掉一台还有两台，也就是说有一台机子可以获取两票，完成选举，重新进入服务状态。
>
> 题外话（投票规则）：zookeeper 原则是先投自己，然后将自己的投票结果同步给别人，别人在它的投票箱子中进行对比，然后改投最强的，再将结果同步回去，查看投票机子是否过半（大家都同票的情况下，判断zxid,  再不行就在判断id [这个是预先配置]）。



### **9、说一下两阶段提交和三阶段提交的过程？分别有什么问题？**



### **10、说下四种类型的数据节点 Znode？**

> 1)  永久节点：只要不手动删除，将永远存在
>
> 2）永久顺序节点
>
> 3）临时节点：与客户端绑定，如果客户端消亡，该节点也将消失
>
> 4）临时顺序节点



### **11、Zookeeper 和 Dubbo 的关系？**



### **12、Zookeeper如何保证一致性 **

> 1）顺序一致性：zookeeper 会严格按照接收到事务的的顺序进行执行（只是写的操作）
>
> 2）原子性：请求事务在任意节点中执行的结果是一样的，要么全部应用成功，要么全部失败
>
> 3）单一视图：Client连接zk集群中的任何一个主机，看到的数据模型都是一致的
>
> 4）可靠性：一旦事物执行成功，那么这个事务将永远保存下来，直到下次被修改
>
> 5）最终一致性：一个事务提交之后，主节点会同步到子节点中（但这个同步时间很短，原因和zk存储的数据量有一定的关系，每个node最多存1M的数据），Client最终能够从zk读取最新数据，但不能保证实时读取。




### **13、Paxos 算法 **

> 是基于消息传递、具有高容错性的一致性算法。
>
> Paxos算法的前提是不存在拜占庭将军问题（*附加*），即信道是可靠的、安全的、集群节点间传递的消息不会被篡改
>
> 




## 题外话

### **1、key \ value 框架的共性是什么 **



### **2、集群的共性是什么 **



### **3、分布式协调框架有哪些，共性是什么，单独又有何特点**





## 附加

###  **1、分布式单点故障问题**

> 用一句话概括就是一个点的故障导致整系统无法使用，在分布式系统中一般采用主从或者是代理的方式，主节点（代理）分配任务（请求），子节点进行业务处理。但是这里容易出现主节点（代理）一点挂掉，整个挂掉（在多个子节点也不可用）。




### **2、拜占庭将军问题 **
> 拜占庭将军问题（Byzantine failures）是点对点通讯中的基本问题。含义是在存在消息丢失的不可靠信道上试图通过消息传递的方式达到一致性是不可能的，因此对一致性的研究一般假设信道可靠，或不存在本问题。



### **3、一般情况下，分布式系统中各个节点间采用的通讯模型**

> 1）共享内存（Shared Memory）
>
> 2）消息传递（Messages Passing）: Paxos 算法是基于此模型